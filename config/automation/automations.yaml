##############################################################################   
#
# Set Day Mode Theme on Start
#
##############################################################################   
- alias: 'Set Day theme at startup'
  initial_state: 'on'
  hide_entity: true
  trigger:
  - platform: homeassistant
    event: start
  condition:
    condition: sun
    after: sunrise
    after_offset: '+00:30:00'
  action:
  - service: frontend.set_theme
    data:
      name: badge #same like the defualt But with Badge color gray
##############################################################################   
#
# Set Night Mode Theme on Start
#
##############################################################################   
- alias: 'Set Night theme at startup'
  initial_state: 'on'
  hide_entity: true
  trigger:
  - platform: homeassistant
    event: start
  condition:
    condition: sun
    after: sunset
    after_offset: '+00:30:00'
  action:
  - service: frontend.set_theme
    data:
      name: dark-mode
##############################################################################   
#
# Set Day Mode Theme
#
##############################################################################   
- alias: 'Set Day Mode Theme after Sunrise'
  initial_state: 'on'
  hide_entity: true
  trigger:
  - platform: sun
    event: sunrise
    offset: '+00:30:00'
  action:
  - service: frontend.set_theme
    data:
      name: badge #same like the defualt But with Badge color gray
##############################################################################   
#
# Set Night Mode Theme
#
##############################################################################   
- alias: 'Set Night Mode Theme after Sunset'
  initial_state: 'on'
  hide_entity: true
  trigger:
  - platform: sun
    event: sunset
    offset: '+00:45:00'
  action:
  - service: frontend.set_theme
    data:
      name: dark-mode
##############################################################################   
#
# Update Available Notifications
#
##############################################################################   
- alias: 'Update Available Notifications'
  hide_entity: true
  trigger:
    platform: state
    entity_id: updater.updater
  action:
    service: notify.ios_elirantur2
    data:
      title: 'Updater'
      message: ' עדכון תוכנה זמין !!!'   #Update for Home Assistant is available
##############################################################################   
#
# HA Startup up and running Notification
#
##############################################################################   
- alias: 'Startup Notification'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: homeassistant
    event: start
  action:
    - service: group.set_visibility
      entity_id: group.security_notification
      data:
        visible: False
    ####
    - service: notify.NotifyEliranIOSAndTelegram 
      data:
        title: 'System info'
        message: 'Home Assistant is Up and Running.'
        data:
          #iOS Only
          attachment: 
            url: https://community-home-assistant-assets.s3-us-west-2.amazonaws.com/original/2X/6/6a99ebb8d0b585a00b407123ff76964cb3e18780.png
            
    - service: camera.local_file_update_file_path
      data:
        entity_id: camera.cctv1_snapshot #use the latest snapshot 
        file_path: '/config/tmp/clean.png'
    - delay: 0:02:00 # to wait all componets will work good
    # - service: shell_command.start_homebridge #not in use - using buidin homekit
    - service: script.turn_on
      entity_id: script.check_sonoffs_version #to update the status of the sonoffs
    # Sonoff power Retein on startup ,
    # "power1" is good for me,in others sonoff setups maybe "power2"/"power3" etc...
    - service: mqtt.publish 
      data:
        topic: "cmnd/sonoffs/state" #Update the power state of all the sonoffs
        payload: ""
    # - service: mqtt.publish
    #   data:
    #     topic: 'cmnd/sonoff_ifan/FanSpeed'
    #     payload: ''
    # - service: mqtt.publish
    #   data:
    #     topic: 'BlueIris/#'
    #     payload: ''        
############################################################
#
# Notify when error in HA config
#
############################################################ 
- alias: 'Notify when error in config'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: persistent_notification.homeassistantcheck_config
    to: 'notifying'
  action:
    service: notify.NotifyEliranIOSAndTelegram
    data:
      title: 'Home Assistant'
      message: 'Config error. See dev-info panel for details.'
      data:
        attachment: 
          url: https://png.icons8.com/nolan/1600/source-code.png

##############################################################################   
#
# Simulate presence (4a) - Working Good , Not in Use for now
#
##############################################################################   
# - alias: "Simulate presence (4a)"
#   initial_state: 'on'
#   trigger:
#   - platform: sun
#     event: sunset
#     offset: '+01:45:00'
#   - platform: event
#     event_type: event_simulate_presence
#   condition:
#     condition: and
#     conditions:
#       - condition: state
#         entity_id: device_tracker.eliraniphone
#         state: 'not_home'
#       - condition: state
#         entity_id: device_tracker.shiraniphone #shiran
#         state: 'not_home'
#       - condition: state
#         entity_id: binary_sensor.xiaomi_motion_sensor_hallway
#         state: 'off'
#         for:
#           minutes: 30
#   action:
#   - service: notify.NotifyEliranIOSAndTelegram
#     data:
#       title: 'אבטחה'  #Security
#       message: 'מצב אורות רנדומלי בפעולה' #Random Lights mode is on   
#       data:
#         push:
#           sound: "US-EN-Morgan-Freeman-Turning-On-The-Mood-Lights.wav"
#           badge: 0
#           category: 'modifymypresence' #the indentefier
#         attachment: 
#           url: https://cdn.dribbble.com/users/1117273/screenshots/3563096/full-color.gif
#   - service: light.turn_on
#     data_template:
#       entity_id: light.white_bulb
#   # wait some seconds (will be in reality in minutes)
#   - delay: '00:{{ (range(2, 10) | random) }}:00'
#   # turn off all devices
#   - service: light.turn_off
#   # wait a little bit before turning on another lamp
#   - delay: '00:00:{{ (range(10, 25) | random) }}'  
#   - service: light.turn_on
#     data_template:
#       entity_id: light.sonoff_light
#   # wait some seconds (will be in reality in minutes)
#   - delay: '00:{{ (range(2, 5) | random) }}:00'
#   # turn off all devices
#   - service: light.turn_off
#   # wait a little bit before turning on another lamp
#   - delay: '00:00:{{ (range(20,35) | random) }}'  
#   # generate an event to call again this automation rule
#   - event: event_simulate_presence
##############################################################################   
#
# Xiaomi CCTV Offline 
#
##############################################################################   
# - alias: 'Hikvision CCTV Offline'
#   initial_state: 'off' #Working good! but not in use
#   trigger:
#     platform: state
#     entity_id: switch.sonoff_xiaomicctv_switch
#     to: 'off'
#     for:
#       minutes: 1
#   action:
#     - service: notify.elirantur2
#       data:
#         title: "מצלמת הסלון"   #Living room CCTV
#         message: 'במצב כבוי'   # Turn Off
#         data:
#           push:
#               badge: 0
#               category: 'modifymycctvswitch' #the indentefier
#           attachment: 
#             url: https://i2.wp.com/etnasasta.com/wp-content/uploads/2018/02/ce677824-4a52-4eeb-b334-ab4801d606ef.gif
##############################################################################   
#
# Hkvision CCTV online and someone at home
#
##############################################################################   
- alias: 'Hikvision CCTV is on alert'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: switch.sonoff_xiaomicctv_switch
    to: 'on'
    for:
      minutes: 1
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: device_tracker.eliraniphone
        state: 'home'
      - condition: state
        entity_id: device_tracker.shiraniphone #shiran
        state: 'home'
  action:
    - service: notify.NotifyEliranIOSAndTelegram
      data:
        title: 'מצלמת הסלון'   #Living room CCTV
        message: 'במצב דלוק,בדוק את סיבת ההדלקה'# Turn Off
        data:
          push:
              badge: 0
              category: 'modifymycctvswitch' #the indentefier
          attachment: 
            url: https://mykharkov.info/wp-content/uploads/2015/03/camera_spying_big_brother_500_clr_4265.gif
##############################################################################   
#
# home CCTV Offline
#
##############################################################################   
# - alias: 'Home CCTV Offline'
#   initial_state: 'off' # Working good but not in use
#   trigger:
#     platform: state
#     entity_id: switch.mqtt_pow2
#     to: 'off'
#     for:
#       minutes: 1
#   action:
#     service: notify.ios_elirantur2
#     data:
#       title: "מצלמת המטבח"  #Kitchen CCTV
#       message: 'במצב כבוי'  #is Off
#       data:
#         push:
#           badge: 0
#           category: 'modifymycctvswitch' #the indentefier
#         attachment: 
#           url: http://fb1-cw.lnwfile.com/lgx068.png
##############################################################################   
#
# home CCTV online and someone at home
#
##############################################################################   
- alias: 'home CCTV is on alert'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: switch.mqtt_pow2
    to: 'on'
    for:
      minutes: 1
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: device_tracker.eliraniphone
        state: 'home'
      - condition: state
        entity_id: device_tracker.shiraniphone #shiran
        state: 'home'
  action:
    - service: notify.NotifyEliranIOSAndTelegram
      data:
        title: 'מצלמת המטבח' #Living room CCTV
        message: 'במצב דלוק,בדוק את סיבת ההדלקה'# Turn Off
        data:
          push:
              badge: 0
              category: 'modifymycctvswitch' #the indentefier
          attachment: 
            url: https://mykharkov.info/wp-content/uploads/2015/03/camera_spying_big_brother_500_clr_4265.gif
##############################################################################   
#
# Xiaomi GateWayOffline
#
##############################################################################   
- alias: 'Xiaomi GateWay Offline'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: device_tracker.xiaomigateway
    to: 'not_home'
    for:
      minutes: 2
  action:
    service: notify.NotifyEliranIOSAndTelegram
    data:
      title: 'רכזת שואמי'   #Xiaomi Gateway
      message: 'הרכזת לא מחוברת לרשת' #is Offline
      data:
        attachment: 
          url: http://mycarcamera.ru/wp-content/uploads/2016/06/migateway-st-05.png
##############################################################################   
#
# turn ON CCTV cameras if late Night
#
##############################################################################   
- alias: 'turn ON CCTV cameras if late Night'
  initial_state: 'on'
  trigger:
    platform: time
    at: '02:00:00'
    # When 'at' is used, you cannot also match on hour, minute, seconds.
    # Military time format.
  action:
    - service: homeassistant.turn_on
      entity_id: switch.mqtt_pow2 #homeCCTV
    - service: homeassistant.turn_on
      entity_id: switch.sonoff_xiaomicctv_switch
      
    - service: automation.turn_off #disable autiomation
      data:
        entity_id: automation.turn_off_cctv_cameras_if_eliran_at_home
    - service: automation.turn_off #disable autiomation
      data:
        entity_id: automation.turn_off_cctv_cameras_if_shiran_at_home
    - service: notify.NotifyEliranIOSAndTelegram
      data:
        title: 'אבטחה'  #Security 
        message:  'השעה 2 בלילה,מצלמות הבית דלוקות'  #the time is 2AM CCTV's are on
        data:
          attachment: 
            url: https://i.pinimg.com/originals/8c/42/d4/8c42d426f7fef619b2e4ee6f9eae6c0d.jpg
##############################################################################   
#
# turn OFF CCTV cameras if Morning and we are at home -Need Some Testing!!!
#
##############################################################################   
- alias:  'turn OFF CCTV cameras if Morning and we are at home'
  initial_state: 'on'
  trigger:
    - platform: time
      at: '06:30:00'
      # When 'at' is used, you cannot also match on hour, minute, seconds.
      # Military time format.
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: device_tracker.eliraniphone
        state: 'home'
      - condition: state
        entity_id: device_tracker.shiraniphone
        state: 'home'

  action:
    - service: homeassistant.turn_off
      entity_id: switch.mqtt_pow2 #homeCCTV
    - service: homeassistant.turn_off
      entity_id: switch.sonoff_xiaomicctv_switch
    - service: notify.NotifyEliranIOSAndTelegram
      data:
        title: 'אבטחה'  #security
        message: 'השעה 6:30 בבוקר, אם אתם בבית ,המצלמות יכבו'  #The time is 6:30AM if someone at home -CCTV OFF
        data:
          push:
              badge: 0
              category: 'modifymycctvswitch' #the indentefier
          attachment: 
            url: http://icons.iconarchive.com/icons/papirus-team/papirus-status/512/camera-off-icon.png

##############################################################################   
#
# turn OFF CCTV cameras if Morning and we are at home -Need Some Testing!!!
#
##############################################################################   
- alias: 'enable Automation 630 AM'
  initial_state: 'on'
  trigger:
    - platform: time
      at: '06:29:00'
  action:
    - service: automation.turn_on #enable automation
      data:
        entity_id: automation.turn_off_cctv_cameras_if_eliran_at_home
    - service: automation.turn_on #enable automation
      data:
        entity_id: automation.turn_off_cctv_cameras_if_shiran_at_home
##############################################################################   
#
# turn off CCTV cameras if shiran at home
#
##############################################################################   
- alias:  'turn off CCTV cameras if shiran at home'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: device_tracker.shiraniphone
    to: 'home'
    # If given, will trigger when state has been the to state for X time.
    for:
      minutes: 1
      seconds: 30
  action:
    - service: homeassistant.turn_off
      entity_id: switch.mqtt_pow2 #homeCCTV
    - service: homeassistant.turn_off
      entity_id: switch.sonoff_xiaomicctv_switch

    - service: notify.ios_shiran_iphone
      data:
        title: 'אבטחה'   #securty
        message: 'ברוך הבא שירן :) מצלמות הבית כבויות'   #Welcome Home Shiran , CCTV off
        data:
          push:
            sound: "US-EN-Morgan-Freeman-Welcome-Home.wav"
            badge: 0
            category: 'modifymycctvswitch' #the indentefier
          attachment: 
            url: https://cdn2.iconfinder.com/data/icons/forbidden-signs/512/forbidden_record_video-512.png

##############################################################################   
#
# turn off CCTV cameras if Eliran at home
#
##############################################################################   
- alias:  'turn off CCTV cameras if Eliran at home'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: device_tracker.eliraniphone
    to: 'home'
    # If given, will trigger when state has been the to state for X time.
    for:
      minutes: 1
      seconds: 30
  action:
    - service: homeassistant.turn_off
      entity_id: switch.mqtt_pow2 #homeCCTV
    - service: homeassistant.turn_off
      entity_id: switch.sonoff_xiaomicctv_switch

    - service: notify.ios_elirantur2
      data:
        title: 'אבטחה' #security
        message: 'ברוך הבא אלירן :) מצלמות הבית כבויות'  #Welcome Home Eliranc, CCTV off
        data:
          push:
            sound: "US-EN-Morgan-Freeman-Welcome-Home.wav"
            badge: 0
            category: 'modifymycctvswitch' #the indentefier
          attachment: 
            url: https://cdn2.iconfinder.com/data/icons/forbidden-signs/512/forbidden_record_video-512.png

##############################################################################   
#
# turn ON CCTV cameras if eliran and shiran not at home
#
##############################################################################   
- alias:  'turn on CCTV cameras if eliran AND shiran NOT at home'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: device_tracker.eliraniphone,device_tracker.shiraniphone
      to: 'not_home'
      # If given, will trigger when state has been the to state for X time.
      for:
        minutes: 1
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: device_tracker.eliraniphone
        state: 'not_home'
      - condition: state
        entity_id: device_tracker.shiraniphone
        state: 'not_home'
  action:
    - service: homeassistant.turn_on
      entity_id: switch.mqtt_pow2 #homeCCTV
    - service: homeassistant.turn_on
      entity_id: switch.sonoff_xiaomicctv_switch
##############################################################################   
#
# cameras and gateway are online 
#
##############################################################################   
- alias: 'Security status'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: binary_sensor.door_sensor_main_entrance
    from: 'on'
    to: 'off'
    for:
      minutes: 5
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: device_tracker.eliraniphone
        state: 'not_home'
      - condition: state
        entity_id: device_tracker.shiraniphone #shiran
        state: 'not_home'
      - condition: state
        entity_id: switch.mqtt_pow2 #home CCTV
        state: 'on'
      - condition: state
        entity_id: switch.sonoff_xiaomicctv_switch
        state: 'on'
      - condition: state
        entity_id: device_tracker.ipc_10 #by Ping     #hikvision_outdoor_cctv_01 #By WRT
        state: 'home'
      - condition: state
        entity_id: device_tracker.xiaomigateway
        state: 'home'
      - condition: state
        entity_id: device_tracker.windows_vm #serverpc Eliran
        state: 'home'        
  action:
    service: notify.NotifyEliranIOSAndTelegram
    data:
      title: 'אבטחה'
      message: 'כל המצלמות והחיישנים פועלים!'
      data:
        push:
          sound: "US-EN-Morgan-Freeman-Front-Door-Locked.wav"
        attachment: 
          url: https://www.trendmicro.com/azure/wp-content/uploads/2016/05/TM_Lock_Sequence_300x300_Looping.gif

##############################################################################   
#
# security warning door open Unauthorised 
# 
##############################################################################  
#Realy Cool Automation ,if Door open Send a Notification with live stream CCTV and save a snapshot from the CCTV
- alias: 'security warning door open unauthorised '
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: binary_sensor.door_sensor_main_entrance
    from: 'on'
    to: 'off'
    for:
      seconds: 15
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: device_tracker.eliraniphone
        state: 'not_home'
      - condition: state
        entity_id: device_tracker.shiraniphone #shiran
        state: 'not_home'
  action:
  - service: rest_command.set_preset_1_homecctv01 #move the camera to the main door.
  - delay: 0:00:03 #give time to the camera to move to the preset
  - service: camera.snapshot
    data:
      entity_id: camera.home_cctv1 #take snapshot with Exact time and save it 
      filename: '/config/tmp/home_cctv1_{{ now().strftime("%d%m%Y-%H%M%S") }}.png' 
  - service: camera.snapshot
    data:
      entity_id: camera.home_cctv1 #take snapshot to update the last snapshot to show in HA
      filename: '/config/tmp/home_cctv1.png'
      
  - service: camera.local_file_update_file_path
    data:
      entity_id: camera.cctv1_snapshot #use the latest snapshot 
      file_path: '/config/tmp/home_cctv1.png'
  - service: rest_command.update_homecctv01_state #update the status of the camera to recording.
  - service: notify.ios_elirantur2
    data:
      title: 'אבטחה' #securty
      message: 'דלת הבית נפתחה לפני 15 שניות, אנא וודא שהכניסה מאושרת!!!'  #Front Door was open 15 sec ago , Check if Unauthorised
      data:
        #iOS Only
        attachment:
          content-type: jpeg
        push:
          sound: "US-EN-Morgan-Freeman-Front-Door-Opened.wav"
          category: camera #PUSH THE CAMERA LIVE STREAM! :) 
        entity_id: camera.home_cctv1 
  - service: notify.ios_homeipad
    data:
      title: 'אבטחה' #securty
      message: 'דלת הבית נפתחה לפני 15 שניות, אנא וודא שהכניסה מאושרת!!!'  #Front Door was open 15 sec ago , Check if Unauthorised
      data:
        #iOS Only
        attachment:
          content-type: jpeg
        push:
          sound: "US-EN-Morgan-Freeman-Front-Door-Opened.wav"
          category: camera #PUSH THE CAMERA LIVE STREAM! :) 
        entity_id: camera.home_cctv1         
        #iOS only End  

  - service: notify.EliranTelegram
    data:
      title: 'אבטחה' #securty
      message: 'דלת הבית נפתחה לפני 15 שניות, אנא וודא שהכניסה מאושרת!!!'  #Front Door was open 15 sec ago , Check if Unau
      data:
        photo:
          - file: /config/tmp/home_cctv1.png
            caption: '{{now().strftime("%Y.%m.%d-%H:%M:%S")}}'
  - delay: 0:15:00 # to hide the camera
  - service: group.set_visibility
    entity_id: group.security_notification
    data:
      visible: False
      

############################################################
#
# send notification upon failed login attempt
# if there was a login attempt with worng password , send Notification with URL and IP of the hacker ;)
############################################################
- alias: 'Send notification upon failed login attempt'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: persistent_notification.httplogin
  condition:
    - condition: template
      value_template: "{{ trigger.to_state.state != off }}"
  action:
    - service: notify.NotifyEliranIOSAndTelegram
      data_template:
        title: 'בוצע נסיון כניסה שנכשל!'   #Failed login attempt!
        message: "{{ states.persistent_notification.httplogin.attributes.message}}"
        #iOS only
        data:
          url: http://extreme-ip-lookup.com/{{ states.persistent_notification.httplogin.attributes.message.split("from ") [1]}}
############################################################
#
# send notification upon IP BAN
# if there was a IP BAN , send Notification with URL and IP of the hacker ;)
############################################################
- alias: 'Send notification upon IP BAN'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: persistent_notification.ipban
  condition:
    - condition: template
      value_template: "{{ trigger.to_state.state != off }}"
  action:
    - service: notify.NotifyEliranIOSAndTelegram
      data_template:
        title: 'אייפיי נחסם!'   #Failed login attempt!
        message: "{{ states.persistent_notification.ipban.attributes.message}}"
        #iOS only
        data:
        
          url: http://extreme-ip-lookup.com/{{ states.persistent_notification.ipban.attributes.message.split("from ") [1]}}      
##############################################################################  
#
# notify if the boiler turn ON
#
##############################################################################  
- alias:  'notify if the boiler turn ON'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: switch._mqtt_pow1
    from: 'off'
    to: 'on'

  action:
    - service: notify.NotifyShiranAndEliranIOS
      data:
        title: 'דוד'
        message: 'הדוד דלוק!'
        data:
          push:
            badge: 0
            category: 'modifymyboilerswitch' #the indentefier      
          attachment: 
            url: https://hasslefreeboilers.com/wp-content/uploads/2017/08/boilerman1.png
    - service: notify.elirantelegram
      data:
        title: 'דוד'
        message: 'הדוד דלוק!'
##############################################################################  
#
# notify if the boiler was on for more then 5 min
#
##############################################################################  
- alias:  'notify if the boiler was on for more then 5 min'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: switch._mqtt_pow1
    to: 'on'
    for:
      minutes: 5
  action:
    - service: notify.ios_elirantur2
      data:
        title: 'דוד' #boiler
        message: 'הדוד דלוק יותר מ5 דקות!'  #the boiler is ON more then 5 min
        data:
          push:
            badge: 0
            category: 'modifymyboilerswitch' #the indentefier       #for custom action from the notification
          attachment: 
            url: http://boilerbooker.com/static/imgs/boilers3_2.gif
    - service: notify.elirantelegram
      data:
        title: 'דוד'
        message: 'הדוד דלוק יותר מ5 דקות!'
##############################################################################  
#
# notify if the boiler turn OFF
#
##############################################################################  
- alias:  'notify if the boiler turn OFF'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: switch._mqtt_pow1
    from: 'on'
    to: 'off'

  action:
    - service: notify.NotifyShiranAndEliranIOS
      data:
        title: 'דוד'  #boiler
        message: 'הדוד מכובה!' #the boiler is off
        data:
          push:
            badge: 0
            category: 'modifymyboilerswitch' #the indentefier      
          attachment: 
            url: https://hasslefreeboilers.com/wp-content/uploads/2017/08/boilerman1.png
    - service: notify.elirantelegram
      data:
        title: 'דוד'
        message: 'הדוד מכובה!'          

##############################################################################  
#                                                  
# boiler on  clock       
#                                                  
##############################################################################  
- alias: 'notify when the boiler clock on start'
  initial_state: 'on'
  trigger:
    platform: template
    value_template: '{{ states.sensor.time.state == states.sensor.boiler_on_clock_time_long.state }}'
  condition:
    condition: state
    entity_id: input_boolean.boiler_on_clock_status
    state: 'on'
  action:
    - service: homeassistant.turn_on
      entity_id: switch._mqtt_pow1
    - service: notify.NotifyEliranIOSAndTelegram
      data:
        title: 'דוד' #boiler
        message: 'הדוד נדלק לפי השעון שהוגדר'  #the boiler is on 
        data:
          attachment: 
            url: http://boilerbooker.com/static/imgs/boilers3_2.gif
    - service: notify.elirantelegram
      data:
        title: 'דוד'
        message: 'הדוד נדלק לפי השעון שהוגדר'  #the boiler is on 
##############################################################################  
#
# boiler off  clock
#
##############################################################################  
- alias: 'notify when the boiler clock off ended'
  initial_state: 'on'
  hide_entity: False
  trigger:
    platform: template
    value_template: '{{ states.sensor.time.state == states.sensor.boiler_off_clock_time_long.state }}'
  condition:
    condition: state
    entity_id: input_boolean.boiler_off_clock_status
    state: 'on'
  action:
    - service: homeassistant.turn_off
      entity_id: switch._mqtt_pow1
    - delay: 0:00:03
    - service: homeassistant.turn_off
      entity_id: input_boolean.boiler_off_clock_status 
    - service: homeassistant.turn_off
      entity_id: input_boolean.boiler_on_clock_status
    - service: notify.NotifyEliranIOSAndTelegram
      data:
        title: 'דוד' #boiler
        message: 'הדוד נכבה לפי השעון שהוגדר'  #the boiler is off
        data:
          attachment: 
            url: http://boilerbooker.com/static/imgs/boilers3_2.gif
    - service: notify.elirantelegram
      data:
        title: 'דוד'
        message: 'הדוד נכבה לפי השעון שהוגדר'  #the boiler is off
##############################################################################  
#
# New Device online -new Device found via asus WRT device_tracker
#
##############################################################################  
- alias: 'Notify for new devices'
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: device_tracker_new_device
  action:
      service: notify.NotifyEliranIOSAndTelegram
      data:
        title: 'Router'
        message: "New device is On-line Check if is authorized at known_devices.yaml"
        data:
          attachment: 
            url: https://servoy.com/wp-content/uploads/mutlidevices_small_forweb.png
##############################################################################  
#
# notify if the home door was open for more then 1 min
#
##############################################################################  
- alias:  'notify if the home door was open for more then 1 min'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: binary_sensor.door_sensor_main_entrance
    from: 'off'
    to: 'on'
    for:
      minutes: 1
  action:
    service: notify.NotifyEliranIOSAndTelegram
    data:
      title: 'חישן הדלת'  #Front Door sensor
      message: 'דלת הבית פתוחה יותר מדקה' #front door is open more then 1 min
      data:
        push:
          sound: "US-EN-Morgan-Freeman-Front-Door-Opened.wav"
        attachment: 
          url: https://static.dezeen.com/uploads/2014/02/Evolution-Door-by-Klemens-Torggler-Dezeen-1.gif
##############################################################################  
#
# Clicks type setup - Wall switch 1 (sofa)
#
############################################################################## 
# Toggle living room left light on single press
- alias: 'Toggle living room left light on single press'
  initial_state: 'on'
  trigger:
    platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.wall_switch_left_158d0001712d0e
      click_type: single
  action:
    service: light.toggle
    entity_id: light.living_room_color_bulb
#Toggle living room right light on single press
- alias: 'Toggle living room right light on single press'
  initial_state: 'on'
  trigger:
    platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.wall_switch_right_158d0001712d0e
      click_type: single
  action:
    service: light.toggle
    entity_id: light.white_bulb
#Toggle living room BOTH  on single press
- alias: 'Toggle living room BOTH  on single press'
  initial_state: 'on'
  trigger:
    platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.wall_switch_both_158d0001712d0e
      click_type: both
  action:
    service: light.toggle
    entity_id: light.sonoff_light #kitchen light
##############################################################################  
#
# Clicks type setup - Wall switch 2 (MAIN enternce)
#
############################################################################## 
#Toggle livingRoom enternce left light on single press
- alias: 'Toggle livingRoom enternce left light on single press'
  initial_state: 'on'
  trigger:
    platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.wall_switch_left_158d0001e119a7
      click_type: single
  action:
  - service: light.toggle
    entity_id: light.white_bulb
  - service: light.toggle
    entity_id: light.living_room_color_bulb
#Toggle livingRoom enternce right light on single press
- alias: 'Toggle livingRoom enternce right light on single press'
  initial_state: 'on'
  trigger:
    platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.wall_switch_right_158d0001e119a7
      click_type: single
  action:
    service: light.toggle
    entity_id: light.sonoff_light
#Toggle livingRoom enternce BOTH  on single press
- alias: 'Toggle livingRoom enternce BOTH  on single press'
  initial_state: 'on'
  trigger:
    platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.wall_switch_both_158d0001e119a7
      click_type: both
  action:
    service: homeassistant.turn_off
    entity_id: group.allmylights
##############################################################################  
#
# Clicks setup - Bed roomSwitch
#
##############################################################################  
#####################
#  duoble click are set in mi-home app (toggel brighness level on desk lamp)
#####################
#Toggle Desk Lamp light on single press
- alias: 'Toggle Bedroom Fan light on single press'
  initial_state: 'on'
  trigger:
    platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.switch_158d0000d8c836
      click_type: single
  action:
    service: light.toggle
    entity_id: light.bedroom_fan_light
#turn off group.allmylights on long press roomSwitch
- alias: 'turn off group.allmylights on long press roomSwitch'
  initial_state: 'on'
  trigger:
    platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.switch_158d0000d8c836
      click_type: long_click_press
  action:
    service: light.turn_off
    entity_id: group.allmylights

##############################################################################  
#
# Klicks type setup -wall ROUNEDED switch
#
##############################################################################  
#Toggle living room lights on single press (ROUND) LivingRoomSwitch
- alias: 'Toggle living room lights on single press LivingRoomSwitch'
  initial_state: 'on'
  trigger:
    platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.switch_158d000149b9ab
      click_type: single
  action:
  - service: light.toggle
    entity_id: light.white_bulb
  - service: light.toggle
    entity_id: light.living_room_color_bulb
#Toggle Hallway light on double click LivingRoomSwitch
- alias: 'Toggle Hallway light on double click LivingRoomSwitch'
  initial_state: 'on'
  trigger:
    platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.switch_158d000149b9ab
      click_type: double
  action:
  - service: light.toggle
    entity_id:  light.sonoff_hallway_light
    
#turn off group.allmylights on long press LivingRoomSwitch  
- alias: 'turn off group.allmylights on long press LivingroomSwitch'
  initial_state: 'on'
  trigger:
    platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.switch_158d000149b9ab
      click_type: long_click_press
  action:
    service: light.turn_off
    entity_id: group.allmylights

##############################################################################  
#
#  'Notify when front door is open on TV' (on androidTV )
#
##############################################################################  
- alias: 'Notify when front door is open on TV'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: binary_sensor.door_sensor_main_entrance
    from: 'off'
    to: 'on'
  action:
    service: notify.PartnerTV #androidTV
    data:
      title: 'תורג׳מן הום'
      message: "דלת הבית פתוחה"
##############################################################################  
#
#  Hot temperature alert
#
##############################################################################  
- alias: 'Hot temperature alert bedroom'
  initial_state: 'on'
  trigger:
    platform: numeric_state
    entity_id: sensor.temperature_bedroom_0 #TEMP SENSOR
    # At least one of the following required
    above: 30
    # below: 25
  action:
  - service: homeassistant.turn_on
    entity_id: light.gateway_light
    data:
      brightness: 255
      rgb_color: [88,0,82] #Purple
  - service: notify.NotifyEliranIOSAndTelegram
    data:
      title: 'מד טמפרטורה'
      message: 'הטמפרטורה בחדר שינה מעל 30 מעלות'
      data:
        attachment: 
          url: https://cdn2.iconfinder.com/data/icons/coloured-weather-icon-set-svg/100/Coloured_Weather_Icon_Set_by_ViconsDesign-12-512.png
##############################################################################  
#
#  cold temperature alert
#
##############################################################################  
- alias: 'cold temperature alert bedroom' #only if Eliran/Shiran at home
  initial_state: 'on'
  trigger:
    platform: numeric_state
    entity_id: sensor.temperature_bedroom_0 #tempsensor
    # At least one of the following required
    below: 16
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: device_tracker.eliraniphone
        state: 'home'
      - condition: state
        entity_id: device_tracker.shiraniphone #shiran
        state: 'home'    
  action:
  - service: notify.NotifyEliranIOSAndTelegram
    data:
      title: 'מד טמפרטורה'
      message: 'הטמפרטורה בחדר השינה ירדה מתחת ל16 מעלות'
      data:
        attachment: 
          url: https://cdn4.iconfinder.com/data/icons/weather-conditions/512/low_temperature-512.png
##############################################################################  
#
#  Hot temperature alert
#
##############################################################################  
- alias: 'Hot temperature alert LivingRoom'
  initial_state: 'on'
  trigger:
    platform: numeric_state
    entity_id: sensor.sensibo1_temp #TEMP SENSOR
    # At least one of the following required
    above: 30
    # below: 25
  action:
  - service: notify.NotifyEliranIOSAndTelegram
    data:
      title: 'מד טמפרטורה'
      message: 'הטמפרטורה בבית מעל 30 מעלות'
      data:
        attachment: 
          url: https://cdn2.iconfinder.com/data/icons/coloured-weather-icon-set-svg/100/Coloured_Weather_Icon_Set_by_ViconsDesign-12-512.png
##############################################################################  
#
#  cold temperature alert
#
##############################################################################  
- alias: 'cold temperature alert LivingRoom'
  initial_state: 'on'
  trigger:
    platform: numeric_state
    entity_id: sensor.sensibo1_temp #tempsensor
    # At least one of the following required
    below: 18
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: device_tracker.eliraniphone
        state: 'home'
      - condition: state
        entity_id: device_tracker.shiraniphone #shiran
        state: 'home'       
  action:
  - service: notify.NotifyEliranIOSAndTelegram
    data:
      title: 'מד טמפרטורה'
      message: 'הטמפרטורה בבית ירדה מתחת ל18 מעלות'
      data:
        attachment: 
          url: https://cdn4.iconfinder.com/data/icons/weather-conditions/512/low_temperature-512.png
##############################################################################  
############################################################################## 
#
#  If there is motion and its dark turn on the gateway light -need some testing!
#
##############################################################################  
- alias: 'If there is motion and its dark turn on the gateway light'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: binary_sensor.xiaomi_motion_sensor_hallway
    from: 'off'
    to: 'on'
  condition:
    condition: and
    conditions:
      - condition: numeric_state
        entity_id: sensor.xiaomi_gateway_illumination
        below: 300
      - condition: time
        after: '20:00:00'
      - condition: or
        conditions:
          - condition: state
            entity_id: device_tracker.eliraniphone
            state: 'home'
          - condition: state
            entity_id: device_tracker.shiraniphone #shiran
            state: 'home'
  action:
    - service: light.turn_on
      entity_id: light.gateway_light
      data:
        brightness: 10
    - delay: 0:00:35
    - service: light.turn_off
      entity_id: light.gateway_light
##############################################################################  
#
# alarm clock       
#
##############################################################################  
- alias: 'notify when the alarm is finish'
  initial_state: 'on'
  trigger:
    platform: template
    value_template: '{{ states.sensor.time.state == states.sensor.alarm_clock_time_long.state }}'
  condition:
    condition: state
    entity_id: input_boolean.alarm_clock_status
    state: 'on'
  action:
    service: notify.NotifyEliranIOSAndTelegram
    data:
      title: 'שעון מעורר' #alarm clock
      message: 'שעון מעורר נגמר!'   #Alarm Clock is Finsh
      data:
        attachment: 
          url: https://cdn.dribbble.com/users/225481/screenshots/1114887/wekker-2.gif

####################################################
#                                                  #
# some of group.AllMylights still ON AT BEDTIME -Need testing      
#                                                  #
####################################################
- alias: 'some of "AllMylights" still ON AT BEDTIME '
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: sensor.eliran_iphone_battery_state
    to: 'Charging'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: group.AllMylights
        state: 'on'
      - condition: time
        after: '23:00:00'
  action:
    - service: notify.ios_elirantur2
      data:
        title: 'לילה טוב'
        message: "התאורה בבית דולקת האם ברצונך לכבות?"
        data:
          push:
            sound: "US-EN-Morgan-Freeman-Good-Night.wav"
            badge: 0
            category: 'modifymylights' #the indentefier
#####################################################
##                                                  #
## some of group.AllMylights is ON nobody at home -alert to turn it off
##                                                  #
#####################################################
- alias: 'some of group.AllMylights is ON and its Before Sunset'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: group.AllMylights #one of the light is on on more
      to: 'on'
      for:
        minutes: 40
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: device_tracker.eliraniphone
        state: 'not_home'
      - condition: state
        entity_id: device_tracker.shiraniphone #shiran
        state: 'not_home'
  action:
    service: notify.NotifyEliranIOSAndTelegram
    data:
      message: 'חלק מאורות הבית נשכחו דלוקים'
      data:
        push:
          sound: "US-EN-Morgan-Freeman-Turning-On-The-Mood-Lights.wav"
          badge: 0
          category: 'modifymylights' #the ID
        attachment: 
          url: https://aeotec.com/images/products/nano_dimmer_new/lightbulb-compatibility.png

####################################################
#                                                  #
# Run the script daily to backup HASS config
#                                                  #
####################################################
- alias: 'Daily HASS Backup'
  initial_state: 'on'
  trigger:
    platform: time
    at: '01:30:00'
  action:
    - service: shell_command.backup_ha_and_move_backup_to_unraid
    - service: notify.NotifyEliranIOSAndTelegram
      data:
        title: 'גיבוי'#backup
        message: 'הגיבוי היומי להום-אסיסטנט בביצוע בדוק סיום תקין בבוקר '    #daily backup of hass configis runing
        data:
          attachment: 
            url: https://d33wubrfki0l68.cloudfront.net/b1c67285b113e40ab92d0136aed5c79f3d3ceb17/69117/images/screenshots/ui2015.png
# ###################################################
# #                                                  #
# # Run the script Weekly to backup all OS (move the img proxmox made and save ha config in server)
# #                                                  #
# ####################################################
- alias: 'Weekly OS Backup'
  initial_state: 'on'
  trigger:
    platform: time
    at: '02:30:00'
  condition:
  - condition: time
    weekday:
      - wed #3 Tuesday at night
      - sun #7 Saturday at night
  action:
    - service: shell_command.backup_ha_and_move_backup_to_unraid
    - service: notify.NotifyEliranIOSAndTelegram
      data:
        title: 'גיבוי'#backup
        message: 'הגיבוי השבועי לכלל המערכת בפעולה! בדוק סיום תקין בבוקר,בקבצי השרת'   #Backup For all the os is in prograss
        data:
          attachment: 
            url: https://www.bullten.com/img/icon/weekly-backup.png

###################################################
#                                                  #
# UpdateMyDNS
#                                                  #
####################################################  
#when my public ip been changed , update the ip in cloudflare and send me Notification
# - alias: IP Address Update
#   hide_entity: true
#   initial_state: true
#   trigger: #if the ip changed - trigger
#     - platform: state
#       entity_id: sensor.myipopendnscom
#   action:
#     - service: cloudflare.update_records #update my DNS
#     - service: notify.NotifyEliranIOSAndTelegram
#       data:
#         title: מצב רשת #Your Public IP has changed to
#         message: "האייפי החיצוני שונה ל: {{ states.sensor.myipopendnscom.state }}"
#         data:
#           attachment: 
#             url: https://images-na.ssl-images-amazon.com/images/I/519-zNN1sCL.png
            
#     - service: persistent_notification.create
#       data_template:
#         title: '{{ as_timestamp(now()) | timestamp_custom("%H:%M:%S", true) }}:עדכון'
#         message: '{{ states.sensor.myipopendnscom.state }} האייפי החיצוני השתנה, כרגע הוא'  #"Your public IP has changed, and is currently {{ states.sensor.myipopendnscom.state }}"
#         notification_id: IP Address Update
#####################################################
##                                                  #
## The air conditioner is ON and nobody at home -alert to turn it off
##                                                  #
#####################################################
- alias: 'The air conditioner is ON and nobody at home'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: climate.living_room 
      to: 'cool'
      for:
        minutes: 20
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: device_tracker.eliraniphone
        state: 'not_home'
      - condition: state
        entity_id: device_tracker.shiraniphone #shiran
        state: 'not_home'
  action:
    service: notify.NotifyEliranIOSAndTelegram
    data:
      title: 'התראה'
      message: 'שכחת את המזגן דלוק! האם לכבות?'
      data:
        push:
          sound: "US-EN-Morgan-Freeman-Turning-Off-The-Air-Conditioner.wav"
          badge: 0
          category: 'modifyaircon' #the ID
        attachment: 
          url: http://www.giersnet.pl/wp-content/uploads/2018/01/klima.png        

#####################################################
##                                                  #
## Some of the MAIN containers are OFF Alert
##                                                  #
#####################################################
- alias: 'Some of the MAIN containers are OFF Alert'
  initial_state: 'on'
  trigger:
    - platform: state #OR State (if one of this switch will turn off , the alert will made)
      entity_id: switch.ha_dockermon_hadockermon,switch.ha_dockermon_letsencrypt,switch.ha_dockermon_unifi,switch.ha_dockermon_unms,switch.ha_dockermon_heimdall #switch.ha_dockermon_cloud9ide
      to: 'off'
      for:
        minutes: 5
  action:
    - service: notify.ios_elirantur2
      data:
        title: 'מצב השרת'   #securty
        message: 'חלק מהקונטיינרים החשובים לעבודה תקינה של המערכת, כבויים בדוק את הסיבה'
        data:
          attachment: 
            url: https://cdn-images-1.medium.com/max/1200/1*6aiG8217Vy9kEpF5k9ag4Q.gif
##############################################################################   
#
# cameras and gateway are online 
#
##############################################################################   
- alias: 'Security status'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: device_tracker.windows_vm #serverpc Eliran
    to: 'not_home'
    for:
      minutes: 5
  action:
    service: notify.NotifyEliranIOSAndTelegram
    data:
      title: 'אבטחה'
      message: ' Blue Iris לא פעילה , בדוק תקינות המערכת הוירטואלית '
      data:
        attachment: 
          url: http://blueirissoftware.com/media/Download_03.png
            
###################################################
#                                                  #
# Telegram ad iOS Notify exemples
#                                                  #
####################################################     
    # - service: notify.EliranTelegram
    #   data:
    #     title: 'System info'
    #     message: 'Home Assistant is Up and Running.'
    #     data:
    #       photo:
    #         - file: /home/homeassistant/.homeassistant/tmp/home_cctv1.png
    #           caption: '{{now().strftime("%Y.%m.%d-%H:%M:%S")}}'
    #         - url : https://community-home-assistant-assets.s3-us-west-2.amazonaws.com/original/2X/6/6a99ebb8d0b585a00b407123ff76964cb3e18780.png
    #           caption: 
    #     # data: {"icon":"https://cdn4.iconfinder.com/data/icons/weather-conditions/512/low_temperature-512.png"}

    # - service: notify.ios_elirantur2
    #   data:
    #     title: "System info"
    #     message: 'Home Assistant is Up and Running.'
    #     data:
    #       attachment: 
    #         url: https://community-home-assistant-assets.s3-us-west-2.amazonaws.com/original/2X/6/6a99ebb8d0b585a00b407123ff76964cb3e18780.png
##############################################################################
####################################################
#                                                  #
# iOS notification action FOR LIGHTS!
#                                                  #
####################################################
- alias: 'iOS notification action ALLMYLIGHTS_OFF'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: ALLMYLIGHTS_OFF #the action that was tap
  action:
    - service: homeassistant.turn_off
      entity_id: group.AllMylights

- alias: 'iOS notification action ONLY_KITCHEN_LIGHT_ON '
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: ONLY_KITCHEN_LIGHT_ON #the action that was tap
  action:
    - service: homeassistant.turn_off
      entity_id: group.AllMylights
    - service: homeassistant.turn_on
      entity_id: light.sonoff_light

- alias: 'iOS notification action ONLY_GATEWAY_LIGHT_ON'
  initial_state: 'on' 
  hide_entity: true
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: ONLY_GATEWAY_LIGHT_ON #the action that was tap
  action:
    - service: homeassistant.turn_off
      entity_id: group.AllMylights
    - service: homeassistant.turn_on
      entity_id: light.gateway_light
####################################################
#                                                  #
# iOS notification action FOR CAMERAS
#                                                  #
####################################################
- alias: 'iOS notification action ALLMYCCTV_INHOME_OFF'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: ALLMYCCTV_INHOME_OFF #the action that was tap
  action:
    - service: homeassistant.turn_off
      entity_id: switch.mqtt_pow2
    - service: homeassistant.turn_off
      entity_id: switch.sonoff_xiaomicctv_switch

- alias: 'iOS notification action CCTV_KITCHEN_ON'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: CCTV_KITCHEN_ON #the action that was tap
  action:
    - service: homeassistant.turn_on
      entity_id: switch.mqtt_pow2

- alias: 'iOS notification action CCTV_XIAOMI_ON'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: CCTV_XIAOMI_ON #the action that was tap
  action:
    - service: homeassistant.turn_on
      entity_id: switch.sonoff_xiaomicctv_switch

- alias: 'iOS notification action ALLMYCCTV_INHOME_ON'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: ALLMYCCTV_INHOME_ON #the action that was tap
  action:
    - service: homeassistant.turn_on
      entity_id: switch.sonoff_xiaomicctv_switch
    - service: homeassistant.turn_on
      entity_id: switch.mqtt_pow2
####################################################
#                                                  #
# iOS notification action FOR BOILER
#                                                  #
####################################################
- alias: 'iOS notification action BOILER_OFF'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: BOILER_OFF #the action that was tap
  action:
    - service: homeassistant.turn_off
      entity_id: group.boiler_setup


- alias: 'iOS notification action BOILER_ON'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: BOILER_ON #the action that was tap
  action:
    - service: homeassistant.turn_on
      entity_id: switch._mqtt_pow1

- alias: 'iOS notification action BOILER_ON_BY_TIMER'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: BOILER_ON_BY_TIMER #the action that was tap
  action:
    - service: homeassistant.turn_on
      entity_id: group.boiler_setup
######################################################
- alias: 'iOS notification action PAUSEPRESENCEMODE'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: PAUSEPRESENCEMODE #the action that was tap
  action:
    - service: automation.turn_off #disable autiomation
      data:
        entity_id: automation.simulate_presence_4a
    - delay: 02:00:00
    - service: automation.turn_on #disable autiomation
      data:
        entity_id: automation.simulate_presence_4a

######################################################
- alias: 'iOS notification action RESETHA'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: RESETHA #the action that was tap
  action:
   - service: homeassistant.restart

####################################################
#                                                  #
# iOS notification action AirCon !
#                                                  #
####################################################
- alias: 'iOS notification action AIRCON_OFF'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: AIRCON_OFF #the action that was tap
  action:
    - service: homeassistant.turn_off
      entity_id: climate.living_room


- alias: 'Dog walk started'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: binary_sensor.door_sensor_main_entrance
    to: 'off'
  action:
    - service: timer.cancel
      entity_id: timer.dogwalk
    - service: timer.start
      entity_id: timer.dogwalk
    
# # # When timer is stopped, the time run out, another message is sent
# # - action:
# #  - service: notify.NotifyEliranIOSAndTelegram
# #     data:
# #       message: 'טיימר טיול כלב נגמר!'
# #       title: "טיימר" 
# #   alias: Dog walk timer stop
# #   id: 'Timerstop'
# #   trigger: 
# #     platform: event
# #     event_type: timer.finished
# #     event_data: 
# #       entity_id: timer.dogwalk 


    # - service: mqtt.publish 
    #   data:
    #     topic: "cmnd/sonoffs/power1" #Update the power state of all the sonoffs
    #     payload: ""
    

                      